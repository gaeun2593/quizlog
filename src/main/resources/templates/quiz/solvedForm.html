<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>단어 카드</title>
  <style>
    /* 기존 스타일 그대로 */
    .card {
      width: 400px;
      height: 250px;
      background-color: #2d2d4d;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin: auto;
      margin-top: 50px;
      border-radius: 15px;
      position: relative;
      cursor: pointer;
    }
    .buttons {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }
    .buttons button {
      width: 50px;
      height: 50px;
      font-size: 1.5rem;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

    .in-progress { color: red; }
    .completed { color: blue; }
  </style>
</head>
<body>


  <div class="card" id="card" onclick="flipCard()">
    <span id="card-text" th:text="${quizSet[0].word}">동조하다</span>
  </div>

  <div class="buttons">
    <button onclick="correctClick()" type="button" name="answer" value="correct" id="correct" style="background-color: #4caf50;">✓</button>
    <button onclick="incorrectClick()" type="button" name="answer" value="wrong" id="incorrect" style="background-color: #ff4d4d;">✕</button>
  </div>

  <div class="chapter-item" th:each="quiz : ${quizSet}">
    <span class="in-progress">현재 학습중인 단어</span>
    <span th:text="${quiz.word}">Title</span>
    <span th:text="${quiz.answer}">Answer</span>
  </div>

  <br>
  <br>

  <div class="chapter-item" th:each="checkquiz : ${checkdQuizs}">
    <span class="completed">학습완료 한 단어</span>
    <span th:text="${checkquiz.word}">Title</span>
    <span th:text="${checkquiz.answer}">Answer</span>
  </div>

  <script th:inline="javascript">
  let flipped = false;
  let quizSet = /*[[${quizSet}]]*/ [];
  let chapterId = [[${chapterId}]];


  let count = 0 ;
  const cardText = document.getElementById('card-text');


  function checkRedirect(){
    if(count === quizSet.length){
      window.location.href = "http://localhost:8080/main/" + chapterId + "/check";

    }
  }

  function incorrectClick(){
    checkRedirect();
    count++ ;
    let {id ,word , answer} = quizSet[count-1];
    cardText.textContent = word;
    fetch('http://localhost:8080/solvedQuiz', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        chapterId : chapterId ,
        id : id ,
        word: word,
        answer: answer ,
        status : "incorrect"

      })
    })
  }

  function correctClick(){
    checkRedirect();
    count++ ;
    let {id ,word , answer} = quizSet[count-1];
    cardText.textContent = word;
    fetch('http://localhost:8080/solvedQuiz', {
         method: 'POST',
         headers: {
           'Content-Type': 'application/json'
         },
         body: JSON.stringify({
           chapterId : chapterId ,
           id : id ,
           word: word,
           answer: answer ,
           status : "correct"
         })
       })
  };

  function flipCard() {
    let {word , answer} = quizSet[count];
    if (!flipped) {
      cardText.textContent = word;
      flipped = true;
    } else {
      cardText.textContent = answer;
      flipped = false ;
    }
  }
</script>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
